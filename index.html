<!DOCTYPE html>
<html>
  <head>
    <script src="./dist/jspsych.js"></script>
    <script src="./dist/plugin-survey-likert.js"></script>
    <script src="./dist/plugin-audio-button-response.js"></script>
    <script src="./dist/plugin-html-button-response.js"></script>
    <script src="./dist/plugin-preload.js"></script>
    <script src="./dist/plugin-instructions.js"></script>
    <script src="./dist/plugin-survey-text.js"></script>
    <link rel="stylesheet" href="./dist/jspsych.css" />
    <script src="examples/js/play_audio.js"></script>
    <script src="examples/js/helper.js"></script>
  </head>
  <body></body>
  <script>

    var jsPsych = initJsPsych({
      on_finish: function() {
        jsPsych.data.displayData();
      }
    });

    var scale1 = ["変わらない","", "", "", "", "","変わった"];

    var scale2 = ["聞きにくい","", "", "", "", "","聞きやすい"];

    var scale3 = ["不快","", "", "", "", "","快"];

    var scale4 = ["遅い","", "", "", "", "","速い"];

    var scale5 = ["ない","", "", "", "", "","ある"];

    var page_num = 0;

    var ntrials = 30;
    
    var sound_index = [];

    filename = ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"]

    filename = [["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],
                ["examples/sound/clap.wav","examples/sound/speech_blue.mp3"],]

    var preload = {
        type: jsPsychPreload,
        auto_preload: true
    }

    var trial_1 = {
      type: jsPsychInstructions,
      pages: ['<p>Welcome to the experiment.</p><p>This is the first set of instructions.</p><p>Click next to begin.</p>',
      ],
      show_clickable_nav: true,
      on_start:function(){
        for(i=0;i<ntrials;i++){sound_index[i]=i;}
        sound_index = create_index(sound_index)
        filename = shuffle_file(filename);
      }
    };



    var audio = {
        type: jsPsychHtmlButtonResponse,
        stimulus: '<button type="button" onclick="connected_play_audiofile_next(filename[sound_index[page_num]])"; class="jspsych-btn">再生</button>',
        choices:['continute'],
        response_allowed_while_playing: false,
        prompt: "<p>練習</p>",
        on_start:function(){
        }
    }

    var likert_trial = {
        type: jsPsychSurveyLikert,
        stimulus: '<b>問題</b></br><button type="button" onclick="connected_play_audiofile(filename[sound_index[page_num]])"; class="jspsych-btn">再生</button>',
        questions: [
          {prompt: "Q1 : 全体的な印象の変化", name: 'Vegetables', labels: scale1, required: true},
          {prompt: "Q2 : 聞きやすさ", name: 'Fruit', labels: scale2, required: true},
          {prompt: "Q3 : 快・不快", name: 'Fruit', labels: scale3, required: true},
          {prompt: "Q4 : テンポ感", name: 'Fruit', labels: scale4, required: true},
          {prompt: "Q5 : リズム感", name: 'Fruit', labels: scale5, required: true}
        ],
        scale_width: 600, 
        on_start:function(trial){
          console.log(sound_index[page_num]);
          connected_play_audiofile(filename[sound_index[page_num]]);
          trial.stimulus = ("<h4>Quiz：").concat((page_num+1).toString()).concat("/").concat(ntrials.toString()).concat("</h4><button type='button' onclick='connected_play_audiofile(filename[sound_index[page_num]])'; class='jspsych-btn'>再生</button>");
        },
        randomize_order: true,
        on_finish:function(){
          stop_play_audiofile();
          page_num++;
        }
    };

    var trial_count = {
      timeline:[likert_trial],
      repetitions: 3,
    }

    var comment = {
      type: jsPsychSurveyText,
      questions: [
        {prompt: '実験に関して何か質問・コメント等ありましたら記述してください', rows: 5}
      ]
    }

    var thankyou = {
      type: jsPsychHtmlButtonResponse,
        stimulus: 'ご協力ありがとうございました',
        choices:['continute'],
        on_start:function(){
          jsPsych.data.get().localSave('csv', 'data.csv');
        }
    }

    jsPsych.run([trial_1, trial_count, comment,thankyou]);
    
  </script>
</html>
